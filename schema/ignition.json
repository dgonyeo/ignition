{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "ignition",
    "type": "object",
    "properties": {
        "ignition": {
            "$ref": "#/ignition-version"
        },
        "storage": {
            "$ref": "#/storage"
        },
        "filesystems": {
            "$ref": "#/filesystems"
        },
        "systemd": {
            "$ref": "#/systemd"
        },
        "networkd": {
            "$ref": "#/networkd"
        },
        "passwd": {
            "$ref": "#/passwd"
        }
    },
    "required": ["ignition"],


    "ignition-version": {
        "type": "object",
        "properties": {
            "version": {
                "type": "string"
            },
            "config": {
                "$ref": "#/ignition-version/definitions/ignition-config"
            },
            "timeouts": {
                "$ref": "#/ignition-version/definitions/timeouts"
            }
        },

        "definitions": {
            "ignition-config": {
                "type": "object",
                "properties": {
                    "append": {
                        "type": "array",
                        "items": {
                            "$ref": "#/ignition-version/definitions/config-reference"
                        }
                    },
                    "replace": {
                        "$ref": "#/ignition-version/definitions/config-reference"
                    }
                }
            },
            "config-reference": {
                "type": "object",
                "properties": {
                    "source": {
                        "type": "string"
                    },
                    "verification": {
                        "type": "string"
                    }
                }
            },
            "timeouts": {
                "type": "object",
                "properties": {
                    "httpResponseHeaders": {
                        "type": "integer"
                    },
                    "httpTotal": {
                        "type": "integer"
                    }
                }
            }
        }
    },

    "storage": {
        "type": "object",
        "properties": {
            "disks": {
                "type": "array",
                "items": { "$ref": "#/storage/definitions/disk" }
            },
            "raid": {
                "type": "array",
                "items": { "$ref": "#/storage/definitions/raid" }
            },
            "filesystems": {
                "type": "array",
                "items": { "$ref": "#/storage/definitions/filesystem" }
            },
            "files": {
                "type": "array",
                "items": { "$ref": "#/storage/definitions/file" }
            },
            "directories": {
                "type": "array",
                "items": { "$ref": "#/storage/definitions/directory" }
            }
        },

        "definitions": {
            "disk": {
                "type": "object",
                "properties": {
                    "device":     { "type": "string" },
                    "wipeTable":  { "type": "boolean" },
                    "partitions": {
                        "type": "array",
                        "items": {
                            "$ref": "#/storage/definitions/partition"
                        }
                    }
                }
            },
            "raid": {
                "type": "object",
                "properties": {
                    "name":   { "type": "string" },
                    "level":  { "type": "string" },
                    "spares": { "type": "integer" },
                    "devices": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "filesystem": {
                "type": "object",
                "properties": {
                    "name":  { "type": "string" },
                    "mount": { "$ref": "#/storage/definitions/mount" },
                    "path":  { "type": "string" }
                }
            },
            "file": {
                "allOf": [
                    { "$ref": "#/storage/definitions/node" },

                    {
                        "properties": {
                            "contents": {
                                "$ref": "#/storage/definitions/file-contents"
                            }
                        }
                    }
                ]
            },
            "directory": {
                "$ref": "#/storage/definitions/node"
            },
            "partition": {
                "type": "object",
                "properties": {
                    "label":    { "type": "string" },
                    "number":   { "type": "integer" },
                    "size":     { "type": "integer" },
                    "start":    { "type": "integer" },
                    "typeGuid": { "type": "string" }
                }
            },
            "mount": {
                "type": "object",
                "properties": {
                    "device": { "type": "string" },
                    "format": { "type": "string" },
                    "create": {
                        "type": "object",
                        "properties": {
                            "force": { "type": "boolean" },
                            "options": {
                                "type": "array",
                                "items": { "type": "string" }
                            }
                        }
                    }
                }
            },
            "file-contents": {
                "type": "object",
                "properties": {
                    "compression":  { "type": "string" },
                    "source":       { "type": "string" },
                    "verification": { "type": "string" }
                }
            },
            "node": {
                "type": "object",
                "properties": {
                    "filesystem": { "type": "string" },
                    "path":       { "type": "string" },
                    "mode":       { "type": "string" },
                    "user": {
                        "type": "object",
                        "properties": {
                            "id": { "type": "integer" }
                        }
                    },
                    "group": {
                        "type": "object",
                        "properties": {
                            "id": { "type": "integer" }
                        }
                    }
                }
            }
        }
    },


    "filesystems": {
        "type": "object",
        "properties": {
            "name":  { "type": "string" },
            "mount": { "$ref": "#/filesystems/definitions/mount" },
            "path":  { "type": "string" }
        },

        "definitions": {
            "mount": {
                "type": "object",
                "properties": {
                    "device": { "type": "string" },
                    "format": { "type": "string" },
                    "create": {
                        "type": "object",
                        "properties": {
                            "force": { "type": "boolean" },
                            "options": {
                                "type": "array",
                                "items": { "type": "string" }
                            }
                        }
                    }
                }
            }
        }
    },

    "systemd": {
        "type": "object",
        "properties": {
            "units": {
                "type": "array",
                "items": { "$ref": "#/systemd/definitions/unit" }
            }
        },

        "definitions": {
            "unit": {
                "type": "object",
                "properties": {
                    "name":     { "type": "string" },
                    "enable":   { "type": "boolean" },
                    "mask":     { "type": "boolean" },
                    "contents": { "type": "string" },
                    "dropins": {
                        "type": "array",
                        "items": { "$ref": "#/systemd/definitions/dropin" }
                    }
                }
            },
            "dropin": {
                "type": "object",
                "properties": {
                    "name":     { "type": "string" },
                    "contents": { "type": "string" }
                }
            }
        }
    },


    "networkd": {
        "type": "object",
        "properties": {
            "units": {
                "type": "array",
                "items": { "$ref": "#/networkd/definitions/networkdunit" }
            }
        },

        "definitions": {
            "networkdunit": {
                "type": "object",
                "properties": {
                    "name":     { "type": "string" },
                    "contents": { "type": "string" }
                }
            }
        }
    },

    "passwd": {
        "type": "object",
        "properties": {
            "users": {
                "type": "array",
                "items": { "$ref": "#/passwd/definitions/user" }
            },
            "groups": {
                "type": "array",
                "items": { "$ref": "#/passwd/definitions/group" }
            }
        },

        "definitions": {
            "user": {
                "type": "object",
                "properties": {
                    "name": { "type": "string" },
                    "passwordHash": { "type": "string" },
                    "sshAuthorizedKeys": {
                        "type": "array",
                        "items": { "type": "string" }
                    },
                    "create": { "$ref": "#/passwd/definitions/usercreate" }
                }
            },
            "group": {
                "type": "object",
                "properties": {
                    "name":         { "type": "string" },
                    "gid":          { "type": "integer" },
                    "passwordHash": { "type": "string" },
                    "system":       { "type": "boolean" }
                }
            },
            "usercreate": {
                "type": "object",
                "properties": {
                    "uid":          { "type": "integer" },
                    "gecos":        { "type": "string" },
                    "homeDir":      { "type": "string" },
                    "noCreateHome": { "type": "boolean" },
                    "primaryGroup": { "type": "string" },
                    "groups": {
                        "type": "array",
                        "items": { "type": "string" }
                    },
                    "noUserGroup": { "type": "boolean" },
                    "system":      { "type": "boolean" },
                    "noLogInit":   { "type": "boolean" },
                    "shell":       { "type": "string" }
                }
            }
        }
    }
}
